<!DOCTYPE html>
<html lang="en">

{% load static %}

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil de Dueño</title>

  <link rel="stylesheet" href="{% static 'core/css/index.css'%}">



  <!--DATATABLE RESPONSIVE CSS-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap5.min.css">
  <!-- DataTable -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
  <!-- DATATABLE BUTTONS CSS     -->
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/select/1.5.0/css/select.dataTables.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <div class="container-fluid" style="margin: 1%;">
    {% block content %}
    {% include 'navbar.html'%}
    {% endblock %}
  </div>

</head>

<body>
  <br>

  {% if user.is_staff == 1 %}
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-10" style=" margin: 0 auto; ">
        <div class="card mb-3" style="border-radius: .5rem;">
          <div class="col-md-12">
            <div class="card-body p-4">
              <h5 class="display-5" style="text-align: center;font-family: sans-serif;">Mi perfil</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ********** INICIO GRILLA CON LOS DATOS DEL PERFIL********** -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-10" style=" margin: 0 auto; ">
        <div class="card mb-3" style="border-radius: .5rem;">
          <div class="row g-0">
            <div class="col-md-4 gradient-custom text-center text-black"
              style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
              <img src="{%static 'core/img/img_cliente.png'%}" alt="Avatar" class="img-fluid my-5"
                style="width: 80px;" />
              <h5>{{user.first_name}} {{user.last_name}}</h5>
              <p>{{user.username}}</p>
              <i class="far fa-edit mb-5"></i>
            </div>
            <div class="col-md-8">
              <div class="card-body p-4">
                <h6>Information</h6>
                <hr class="mt-0 mb-4">
                <div class="row pt-1">
                  <div class="col-6 mb-3">
                    <h6>nombres</h6>
                    <p class="text-muted">{{usuario.nombre}}</p>
                  </div>
                  <div class="col-6 mb-3">
                    <h6>Primer apellido</h6>
                    <p class="text-muted">{{usuario.p_apellido}}</p>
                  </div>
                  <div class="col-6 mb-3">
                    <h6>Segundo apellido</h6>
                    <p class="text-muted">{{usuario.s_apellido}}</p>
                  </div>
                  <div class="col-6 mb-3">
                    <h6>email</h6>
                    <p class="text-muted">{{usuario.correo}}</p>
                  </div>
                  <div class="col-6 mb-3">
                    <h6>Comuna</h6>
                    <p class="text-muted">{{usuario.comuna.nombre}}</p>
                  </div>
                  <div class="col-6 mb-3">
                    <h6>Region</h6>
                    <p class="text-muted">{{usuario.region.nombre}}</p>
                  </div>
                </div>
                <!-- <div class="d-flex justify-content-start">
                    <a href="#!"><i class="fab fa-facebook-f fa-lg me-3"></i></a>
                    <a href="#!"><i class="fab fa-twitter fa-lg me-3"></i></a>
                    <a href="#!"><i class="fab fa-instagram fa-lg"></i></a>
                  </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ********** FIN GRILLA CON LOS DATOS DEL PERFIL********** -->

      <!-- ---------GRILLA CON LOS ESTACIONAMIENTOS DEL USUARIO DUEÑO -->
      <div class="col-sm-10" style="  margin: 0 auto;  ">
        <div class="card mb-3" style="border-radius: .5rem;">
          <div class="row">
            <div class="col">
              <div class="card-body p-4">

                <h5>Mis estacionamientos </h5>
              </div>

              <hr class="mt-0 mb-4">
              <div class="container md-4">
                <div class="row">
                  <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="title">

                      <div class="container-fluid">
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                          <button class="btn btn-sm btn-success"> Agregar Estacionamiento</a></button>
                        </div>
                      </div>
                      <br>

                      <div class="table-responsive">
                        <table class="table table-striped dt-responsive" style="width:100%;" id="myTable">
                          <thead>
                            <tr>
                              <th style="width:5%;">ID</th>
                              <th style="width:15%;">Nombre Estacionamiento</th>
                              <th style="width:25%;">Horario</th>
                              <th style="width:10%;">Precio</th>
                              <!-- <th style="width:5%;">Acciones</th> -->
                              <th style="width:5%;">Habilitar</th>
                              <th style="width:10%;">Deshabilitar</th>
                              <th style="width:10%;">Ver Detalle</th>
                              <!-- <th style="width:5%;">Aceptar</th> -->
                              <th style="width:5%;">Eliminar</th>
                              <th style="width:5%;">Editar</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for est in estacionamiento %}
                            <tr>
                              <td>{{est.idEstacionamiento}}</td>
                              <td>{{est.direccionEst}}</td>
                              <td>{{est.horario}}</td>
                              <td>{{est.precio}}</td>

                              {% if est.estado == "Habilitado" %}
                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn">
                                    <a class="a">
                                      <i class="fa-solid fa-car-side fa-xl" style="color: #25d43a;"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>
                              {% else %}
                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn" disabled>
                                    <a class="a">
                                      <i class="fa-solid fa-car-side fa-xl" style="color: #616261;"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>

                              {% endif %}

                              {% if est.estado == "Deshabilitado" %}


                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn">
                                    <a class="a">
                                      <i class="fa-solid fa-car-side fa-xl" style="color: #d42525;"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>
                              <td>
                                {% else %}
                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn" disabled>
                                    <a class="a">
                                      <i class="fa-solid fa-car-side fa-xl" style="color: #727070;"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>
                              <td>
                                {% endif %}

                                <div class="d-flex justify-content-center">
                                  <button class="btn">
                                    <a class="a">
                                      <i class="fa-sharp fa-solid fa-eye fa-xl"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>

                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                    <a href="#">
                                      <i class="fa-solid fa-trash fa-lg" style="color: #e52a2a;"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>
                              <td>
                                <div class="d-flex justify-content-center">
                                  <button class="btn">
                                    <a href="#">
                                      <i class="fa-solid fa-pencil fa-lg"></i>
                                    </a>
                                  </button>
                                </div>
                              </td>

                              </td>
                            </tr>
                            {% endfor %}

                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="d-flex justify-content-start">
                    <a href="#!"><i class="fab fa-facebook-f fa-lg me-3"></i></a>
                    <a href="#!"><i class="fab fa-twitter fa-lg me-3"></i></a>
                    <a href="#!"><i class="fab fa-instagram fa-lg"></i></a>
                  </div> -->
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div>

  <!-- Modal Eliminar  -->

  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Eliminar estacionamiento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ¿Desea eliminar de forma permanente su estacionamiento?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary">Eliminar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal visualizar detalles -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Understood</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal modificar detalles -->
  <div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Understood</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Crear estacionamiento -->
  <div class="modal fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Understood</button>
        </div>
      </div>
    </div>
  </div>

  {% endif %}

  <!-- ****PERFIL DE CLIENTE**** -->
  {% if user.is_staff == 0 %}
  <div class="container-fluid">
    <h2 class="display-2 text-center my-5">Mi perfil</h2>
    <div class="row">
      <div class="col-md-4">
        <div class="card bg-primary text-white mb-3">
          <div class="card-body text-center">
            <img src="{%static 'core/img/img_cliente.png'%}" alt="Avatar" class="img-fluid rounded-circle mb-3"
              style="width: 100px;" />
            <h5 class="card-title">{{user.first_name}} {{user.last_name}}</h5>
            <p class="card-text">{{user.username}}</p>
            <a href="#" class="btn btn-light btn-sm"><i class="far fa-edit"></i> Editar</a>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">Información</h5>
            <hr>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="nombre">Nombres</label>
                  <input type="text" class="form-control" id="nombre" value="{{usuario.nombre}}" readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="p_apellido">Primer apellido</label>
                  <input type="text" class="form-control" id="p_apellido" value="{{usuario.p_apellido}}" readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="s_apellido">Segundo apellido</label>
                  <input type="text" class="form-control" id="s_apellido" value="{{usuario.s_apellido}}" readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="correo">Email</label>
                  <input type="email" class="form-control" id="correo" value="{{usuario.correo}}" readonly>
                </div>
              </div>
            </div>
            <h5 class="card-title mt-5">Proyectos</h5>
            <hr>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="recent">Recientes</label>
                  <input type="text" class="form-control" id="recent" value="Lorem ipsum" readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="viewed">Más vistos</label>
                  <input type="text" class="form-control" id="viewed" value="Dolor sit amet" readonly>
                </div>
              </div>
            </div>
            <!-- <div class="text-center mt-5">
              <a href="#" class="btn btn-primary btn-lg"><i class="fab fa-facebook-f"></i></a>
              <a href="#" class="btn btn-primary btn-lg"><i class="fab fa-twitter"></i></a>
              <a href="#!"><i class="fab fa-instagram fa-lg"></i></a>
            </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- MAPA -->
  <div class="col-md-12 col-lg-12 mx-auto my-3">
    <div class="card border-0 shadow-sm rounded">
      <div class="card-body p-4">
        <h3 class="card-title mb-4">Ver Estacionamientos cercanos</h3>
        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
          <button class="btn btn-primary" style="text-align: left;" onclick="findMe()">Ver ubicación</button>
        </div>
        <div class="mt-4">
          <div id="map" style="height: 300px;"></div>
          <script>
            function findMe() {
              var output = document.getElementById('map');

              // Configurar opciones de geolocalización
              var options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
              };

              // Verificar si soporta geolocalizacion
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(localizacion, error, options);
                output.innerHTML = "<p>Obteniendo tu ubicación...</p>";
              } else {
                output.innerHTML = "<p>Tu navegador no soporta Geolocalizacion</p>";
              }

              //Obtenemos latitud y longitud
              function localizacion(posicion) {
                var latitude = posicion.coords.latitude;
                var longitude = posicion.coords.longitude;

                // Crear mapa
                var map = new google.maps.Map(output, {
                  center: { lat: latitude, lng: longitude },
                  zoom: 14,
                });

                // Agregar marcador en la ubicación del usuario
                var marker = new google.maps.Marker({
                  position: { lat: latitude, lng: longitude },
                  map: map,
                  icon: 'https://maps.google.com/mapfiles/kml/shapes/man.png',
                  title: "Tu ubicación",
                });

                // Buscar lugares cercanos y agregar descripción
                var request = {
                  location: { lat: latitude, lng: longitude },
                  radius: 5000,
                  type: ['parking']
                };

                var service = new google.maps.places.PlacesService(map);

                service.nearbySearch(request, function (results, status) {
                  if (status === google.maps.places.PlacesServiceStatus.OK) {
                    for (var i = 0; i < results.length; i++) {
                      var place = results[i];
                      var placeLocation = place.geometry.location;

                      // Agregar marcador para cada lugar encontrado
                      var marker = new google.maps.Marker({
                        map: map,
                        position: place.geometry.location,
                        title: place.name,
                      });

                      // Agregar descripción para cada lugar encontrado
                      var content = '<div><strong>' + place.name + '</strong><br>' +
                        'Dirección: ' + place.vicinity + '<br>' +
                        'Rating: ' + place.rating + '</div>';

                      var infoWindow = new google.maps.InfoWindow({
                        content: content
                      });

                      marker.addListener('click', function () {
                        infoWindow.open(map, marker);
                      });
                    }
                  }
                });
              }

              function error() {
                output.innerHTML = "<p>No se pudo obtener tu ubicación</p>";
              }
            }
          </script>
          <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeW11IBOI1XI68D733CK_h6tAxMsqNrO0&callback=initMap&libraries=places"></script>
        </div>
      </div>
    </div>
  </div>


  <!-- FIN MAPA -->
  <!-- key=AIzaSyCeW11IBOI1XI68D733CK_h6tAxMsqNrO0 -->

  </div>
  </div>
  </div>
  {% endif %}


  <!--***** Footer ***** -->
  {% include 'Footer.html'%}
  <!-- **** Footer FIN *****-->

</body>

<!-- ****** DATATABLE ******-->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<!-- jQuery -->
<!-- DataTable -->
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/responsive.bootstrap5.min.js"></script>
<!-- FUNCION Descarga -->
<script src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/select/1.5.0/js/dataTables.select.min.js"></script>
<!-- FUNCION dataTable -->
<script>
  $(document).ready(function () {
    $('#myTable').DataTable({
      lengthMenu: [
        [10, 25, 50, -1],
        [10, 25, 50, 'All'],
      ],
      dom: 'Bfrtip',
      buttons: [
        // 'copy',
        // 'csv',
        'excel',
        'pdf'
        // {
        //     extend: 'print',
        //     text: 'Imprimir pantalla',
        //     exportOptions: {
        //         modifier: {
        //             selected: null
        //         }
        //     }
        // }
      ],
      select: false,
      pageLength: 5,
      language: {
        lengthMenu: "Mostrar _MENU_ registros por página",
        zeroRecords: "Ningún usuario encontrado",
        info: "Mostrando de _START_ a _END_ de un total de _TOTAL_ registros",
        infoEmpty: "Ningún usuario encontrado",
        infoFiltered: "(filtrados desde _MAX_ registros totales)",
        search: "Buscar:",
        loadingRecords: "Cargando...",
        paginate: {
          first: "Primero",
          last: "Último",
          next: "Siguiente",
          previous: "Anterior"
        }
      },
    });
    responsive: true
    autoWidth: false
    paging: false
  });
</script>


<!-- key=AIzaSyCeW11IBOI1XI68D733CK_h6tAxMsqNrO0 -->

</html>